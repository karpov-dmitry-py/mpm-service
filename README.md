# STL service

## Сервис управления товарами и заказами в маркетплейсах.

#### Необходимые действия для выполнения доработок:

1. Стать участником команды разработки проекта (project collaborator) в github (https://github.com/settings/keys) - (требуется участие администратора проекта)
1. Добавить публичный ssh-ключ своей машины в github для работы с репозиторием проекта (https://github.com/karpov-dmitry-py/mpm-service/settings/access -  (требуется участие администратора проекта)
1. Склонировать к себе репозиторий проекта - `git clone git@github.com:karpov-dmitry-py/mpm-service.git`
1. Декомпозировать релиз (крупная задача) на подзадачи фичи в трекере (релизы и состав фичей релиза будем вести в таск трекере - предпочтительно в джире)
1. Создать новую ветку от мастера с именем ветки по паттерну "release/НОМЕР_РЕЛИЗА" и запушить в репозиторий проекта на github 
1. Создать новую ветку от релизной ветки c именем по паттерну "feature/НОМЕР_ФИЧИ" 
1. Выполнить все существующие в текущей ветке миграции (см доку джанго по выполнению миграций) и вести разработку фичи в этой ветке
1. Изменения по фиче запушить в репозиторий проекта на сервере в такую же новую фича-ветку, сообщение коммита должно иметь паттерн "[НОМЕР_ФИЧИ] КРАТКОЕ ОПИСАНИЕ СУТИ СДЕЛАННОГО" (все в lower case). Пример команды пуша - `git push -f --set-upstream origin feature/1698`
1. Открыть pull request (PR) в релизную ветку и пройти ревью изменений у коллеги по проекту (получить аппрув или исправить замечания)
1. Вмержить PR фича-ветки в релизную ветку
1. После влития всех фич релиза открыть PR на залитие всех изменений релиза в мастер и залить релиз в мастер
1. Зайти на удаленный сервер проекта (креды - у администратора проекта) и в директории `/service/code/mpm-service` спулить изменения в локальную директорию проекта из мастера - `git pull` (позднее пуллинг переедет как автоматическое действие в скрипт ниже)
1. В директории `/service/deploy/` выполнить скрипт -  `./remote-build-deploy.sh` и по логам скрипта убедиться, что контейнеры приложения и БД пересоздались и поднялись.
1. Проверить сервис https://stl-market.ru на работоспособность

Ближайшие задачи тех. долга:

* включить пуллинг кода репозитория на сервере для деплоя в скрипт деплоя
* в модуле `scheduler` сделать автоматическое определение локального/серверного окружения - сейчас окружение определяется по полю класса - для локальной разработки нужно принудительно изменить значение на 'dev' 
* придумать способ мержа миграций (изменения состава и структуры таблиц БД) при командной разработке
* при старте шедулера факт запуска фиксировать не в виде файла в файловой системе, а в редисе (добавить докер-контейнер с редисом)  
